<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>nginx平滑升级 | 丁小样同学</title>

    <meta name="author" content="丁小样同学">
    
    <meta name="description" content="丁小样同学博客">
    
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

    <!-- 新 Bootstrap 核心 CSS 文件 -->
    <link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <!-- 可选的Bootstrap主题文件（一般不用引入） -->
    <link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.3.4/css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="/css/default.css" type="text/css"/>
    <!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
    <script src="http://cdn.bootcss.com/jquery/1.11.3/jquery.min.js"></script>
    <!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
    <script src="http://cdn.bootcss.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <script>
    var _hmt = _hmt || [];
    (function() {
    var hm = document.createElement("script");
    hm.src = "//hm.baidu.com/hm.js?0c604cca6874b9c92af854adbc6cf0dd";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
    })();
    </script>
</head>
<body>

<header role="banner" id="top" class="navbar navbar-static-top bs-docs-nav">
    <div class="container">
        <div class="navbar-header">
            <button aria-controls="navbar" aria-expanded="false" data-target="#navbar" data-toggle="collapse" class="navbar-toggle collapsed" type="button">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">丁小样同学</a>
        </div>
        <nav id="navbar" class="collapse navbar-collapse bs-navbar-collapse">
            <ul class="nav navbar-nav">
                
                
                
                <li class="">
                    <a href="/index.html">首页</a>
                </li>
                
                
                
                <li class="">
                    <a href="/navigations/archives.html">文章归档</a>
                </li>
                
                
                
                <li class="">
                    <a href="/navigations/works.html">作品</a>
                </li>
                
                
                
                <li class="">
                    <a href="/navigations/contact.html">联系我</a>
                </li>
                
                
                
                <li class="">
                    <a href="/navigations/links.html">友情链接</a>
                </li>
                
            </ul>
        </nav>
    </div>
</header>


<div class="bs-docs-header">
    <div class="container">
        <h1>blog.dinghz.com</h1>

        <p>没错，这满满都是技术类的文章。把自己看到的、学到的都记录下来，也是自己一本不错的备忘录!</p>
    </div>
</div>


<link rel="stylesheet" href="/css/pygments.css" type="text/css"/>

<div class="container-fluid bs-docs-container">
    <div class="row">
        <h2 class="page-header" id="download">nginx平滑升级</h2>
        <h3>重命名主进程文件</h3>

<p>旧版本 nginx 的主进程将重命名它的 pid 文件为 .oldbin(例如：/usr/local/nginx/logs/nginx.pid.oldbin) </p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nv">$ </span><span class="nb">kill</span> -USR2 【旧颁布的Nginx主进程号】  
</code></pre></div>
<h3>同时运行nginx</h3>

<p>新、旧版本的nginx 实例会同时运行，共同处理输入的请求。要逐步停止旧版本的 nginx 实例，你必须发送 WINCH 信号给旧的主进程，然后，它的工作进程就将开始从容关闭 </p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nv">$ </span><span class="nb">kill</span> -WINCH 【旧版本的Nginx主进程号】
</code></pre></div>
<h3>升级或恢复</h3>

<p>可以决定是使用新版本，还是恢复到旧版本 </p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nv">$ </span><span class="nb">kill</span> 【新的主进程号或旧的主进程号】
</code></pre></div>
        
        <div style="padding: 5px; margin: 10px 0px; height: 35px;">
            <div class="pull-right">
                
                <a href="/2014/04/08/memcached.html" title="Memcached高性能的分布式内存对象缓存系统">
                    <button type="button" class="btn btn-primary">
                        <span class="paging">Memcached高性能的分布式内存对象缓存系统&nbsp;<i class="glyphicon glyphicon-menu-right"></i></span>
                    </button>
                </a>
                
            </div>
            <div class="pull-left">
                
                <a href="/2014/12/31/mysqldump.html" title="mysqldump命令的用法">
                    <button type="button" class="btn btn-primary">
                        <span class="paging"><i class="glyphicon glyphicon-menu-left"></i>&nbsp;mysqldump命令的用法</span>
                    </button>
                </a>
                
            </div>
        </div>
        
        <div class="comment">
            
                <div class="comment-cnt">
                    <div id="disqus_thread"></div>
                </div>
            
        </div>
    </div>
    
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES * * */
        var disqus_shortname = 'craneding';
        
        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</div>


</body>
</html>
